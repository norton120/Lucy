version: "3.9"
services:
  sid_webserver:
    image: nginx:alpine
    hostname: sid-webserver
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - sid_fastapi
  sid_fastapi:
    image: sid_fastapi
    hostname: sid-fastapi
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./MemGPT:/packages/MemGPT
      - ./src:/packages/sid
      - ./fastapi_test/app:/app/app
    env_file:
      - .env
    environment:
      POSTGRES_USER: sid
      POSTGRES_PASSWORD: sid
      POSTGRES_DB: sid_fastapi
    depends_on:
      - sid_db
  # TODO: sid_django
  sid_db:
    image: ankane/pgvector:v0.5.1
    hostname: sid-db
    environment:
      POSTGRES_USER: sid
      POSTGRES_PASSWORD: sid
      POSTGRES_DB: postgres
    volumes:
      - .data/postgres-data:/var/lib/postgresql/data
  sid_langfuse:
    image: ghcr.io/langfuse/langfuse:latest
    hostname: sid-langfuse
    environment:
      - DATABASE_URL=postgresql://sid:sid@sid-db:5432/langfuse
      - NEXTAUTH_URL=http://langfuse.localhost
      - NEXTAUTH_SECRET=secret
      - SALT=salt
    depends_on:
      - sid_db
networks:
  default:
    name: sid